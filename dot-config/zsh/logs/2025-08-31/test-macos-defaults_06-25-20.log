🧪 Testing Deferred macOS Defaults Execution System
==================================================
📅 Test Started: 2025-08-31T06:25:20Z
📋 Log File: /Users/s-a-c/.config/zsh/logs/2025-08-31/test-macos-defaults_06-25-20.log

1. Testing wrapper script existence and configuration...
   ❌ Wrapper script missing: /Users/s-a-c/.config/zsh/.zshrc.pre-plugins.d/03-macos-defaults-deferred.zsh
2. Testing first run behavior (no marker file)...
   🗑️  Removing existing marker file: /Users/s-a-c/.config/zsh/.macos-defaults-last-run
   📥 Sourcing wrapper function...
_test_first_run:source:11: no such file or directory: /Users/s-a-c/.config/zsh/.zshrc.pre-plugins.d/03-macos-defaults-deferred.zsh
   ❌ Marker file not created on first run
_test_first_run:24: no matches found: /Users/s-a-c/.config/zsh/logs/2025-08-31/deferred-macos-defaults_*.log
   ❌ No deferred execution log file found

3. Testing skip behavior (marker file exists and recent)...
   ⚠️  Creating marker file for skip test
_test_skip_behavior:10: no matches found: /Users/s-a-c/.config/zsh/logs/2025-08-31/deferred-macos-defaults_*.log
   📥 Sourcing wrapper function (second time)...
_test_skip_behavior:source:14: no such file or directory: /Users/s-a-c/.config/zsh/.zshrc.pre-plugins.d/03-macos-defaults-deferred.zsh
_test_skip_behavior:17: no matches found: /Users/s-a-c/.config/zsh/logs/2025-08-31/deferred-macos-defaults_*.log
   ❌ No log file found for skip test

4. Testing script modification detection...
   📥 Sourcing wrapper after script modification...
_test_modification_detection:source:12: no such file or directory: /Users/s-a-c/.config/zsh/.zshrc.pre-plugins.d/03-macos-defaults-deferred.zsh
_test_modification_detection:15: no matches found: /Users/s-a-c/.config/zsh/logs/2025-08-31/deferred-macos-defaults_*.log
   ❌ No log file found for modification test

5. Testing startup time with deferred execution...
   📊 Deferred execution time: 2ms
   ✅ Deferred execution is fast (< 100ms)

6. Testing log file organization...
   ✅ Date-named log directory exists: /Users/s-a-c/.config/zsh/logs/2025-08-31
_test_log_organization:13: no matches found: /Users/s-a-c/.config/zsh/logs/2025-08-31/deferred-macos-defaults_*.log
   ❌ No UTC-timestamped log files found

🏁 Test Results Summary
======================
✅ Tests Passed: 2
❌ Tests Failed: 6
📊 Total Tests: 8

⚠️  Some deferred macOS defaults tests failed
❌ Task 2.1 needs attention
